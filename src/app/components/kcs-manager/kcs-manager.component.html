<div class="container">
  <!-- Header Section -->
  <mat-toolbar class="header-toolbar">
    <div class="header-content">
      <div class="title-container">
        <h1 class="header-title">
          <mat-icon class="header-icon">verified</mat-icon>
          KCS Manager - Quản lý bảng vẽ & khâu quấn dây
        </h1>
        <p class="header-subtitle">Tìm kiếm, theo dõi và kiểm duyệt các bảng vẽ đã xử lý trước khi KCS duyệt</p>
      </div>
    </div>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Search Section -->
    <div class="search-section">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Tìm kiếm bảng vẽ...</mat-label>
        <input matInput 
               [(ngModel)]="searchTerm"
               (input)="onSearchChange($event)"
               placeholder="Nhập ký hiệu quấn dây, tên bảng vẽ, công suất...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <!-- Data Table -->
    <div class="table-container">
      <!-- Loading indicator -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Đang tải dữ liệu...</p>
      </div>

      <!-- No data message -->
      <div *ngIf="!isLoading && dataSource.data.length === 0" class="no-data-container">
        <mat-icon>inbox</mat-icon>
        <p>Không có dữ liệu bảng vẽ chờ kiểm duyệt</p>
      </div>

      <!-- Data table -->
      <table *ngIf="!isLoading && dataSource.data.length > 0" 
             mat-table [dataSource]="dataSource" class="kcs-table">
        
        <!-- Ký hiệu bảng vẽ Column -->
        <ng-container matColumnDef="kyhieuBangVe">
          <th mat-header-cell *matHeaderCellDef>Ký hiệu bảng vẽ</th>
          <td mat-cell *matCellDef="let element">
            <span class="kyhieu-link" (click)="onViewDetails(element)">
              {{ element.kyhieubangve || 'N/A' }}
            </span>
          </td>
        </ng-container>

        <!-- Công suất Column -->
        <ng-container matColumnDef="congSuat">
          <th mat-header-cell *matHeaderCellDef>Công suất</th>
          <td mat-cell *matCellDef="let element">
            {{element.congsuat}} kVA
          </td>
        </ng-container>

        <!-- TBKT Column -->
        <ng-container matColumnDef="tbkt">
          <th mat-header-cell *matHeaderCellDef>TBKT</th>
          <td mat-cell *matCellDef="let element">
            {{element.tbkt}}
          </td>
        </ng-container>

        <!-- Ngày sản xuất Column -->
        <ng-container matColumnDef="ngaySanXuat">
          <th mat-header-cell *matHeaderCellDef>Ngày sản xuất</th>
          <td mat-cell *matCellDef="let element">
            {{element.ngaysanxuat | date:'dd/MM/yyyy'}}
          </td>
        </ng-container>

        <!-- Ngày gia công Column -->
        <ng-container matColumnDef="ngayGiaCong">
          <th mat-header-cell *matHeaderCellDef>Ngày gia công</th>
          <td mat-cell *matCellDef="let element">
            {{element.ngaygiacong | date:'dd/MM/yyyy'}}
          </td>
        </ng-container>

        <!-- Trạng thái Column -->
        <ng-container matColumnDef="trangThai">
          <th mat-header-cell *matHeaderCellDef>Trạng thái</th>
          <td mat-cell *matCellDef="let element">
            <div class="status-badge" [ngClass]="getStatusClass(element.trang_thai)">
              <span class="status-dot"></span>
              <span class="status-text">{{getStatusText(element.trang_thai)}}</span>
            </div>
            <div class="loai-boi-day">
              {{getLoaiBoiDayText(element.loai_boi_day)}}
            </div>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Thao tác</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button [matMenuTriggerFor]="menu" class="action-button">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="onApproveKcs(element)">
                <mat-icon>verified</mat-icon>
                <span>Kiểm duyệt KCS</span>
              </button>
              <button mat-menu-item (click)="onViewDetails(element)">
                <mat-icon>visibility</mat-icon>
                <span>Xem chi tiết</span>
              </button>
              <button mat-menu-item (click)="onDownload(element)">
                <mat-icon>download</mat-icon>
                <span>Tải xuống</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Pagination -->
      <div *ngIf="!isLoading && dataSource.data.length > 0" class="pagination-container">
        <mat-paginator 
          [length]="totalCount"
          [pageSize]="pageSize"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [pageIndex]="currentPage - 1"
          (page)="onPageChange($event)"
          showFirstLastButtons 
          aria-label="Select page of processed drawings">
        </mat-paginator>
        
        <!-- Additional pagination info -->
        <div class="pagination-info">
          <span>Hiển thị {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} của {{totalCount}} kết quả</span>
        </div>
      </div>
    </div>
  </div>
</div>
