<div class="change-password-dialog">
  <h2 mat-dialog-title>
    <mat-icon>lock_reset</mat-icon>
    Đổi mật khẩu cho {{ data.user.fullName || data.user.username }}
  </h2>

  <mat-dialog-content>
    <div class="user-info">
      <p><strong>Username:</strong> {{ data.user.username }}</p>
      <p><strong>Email:</strong> {{ data.user.email }}</p>
    </div>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
      <div class="form-field">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Mật khẩu mới *</mat-label>
          <input matInput 
                 [type]="hideNewPassword ? 'password' : 'text'"
                 formControlName="newPassword"
                 placeholder="Nhập mật khẩu mới">
          <button mat-icon-button 
                  matSuffix 
                  type="button"
                  (click)="hideNewPassword = !hideNewPassword"
                  [attr.aria-label]="'Hide password'"
                  [attr.aria-pressed]="hideNewPassword">
            <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </mat-form-field>
        <mat-error *ngIf="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched">
          {{ getErrorMessage('newPassword') }}
        </mat-error>
      </div>

      <div class="form-field">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Xác nhận mật khẩu *</mat-label>
          <input matInput 
                 [type]="hideConfirmPassword ? 'password' : 'text'"
                 formControlName="confirmPassword"
                 placeholder="Nhập lại mật khẩu mới">
          <button mat-icon-button 
                  matSuffix 
                  type="button"
                  (click)="hideConfirmPassword = !hideConfirmPassword"
                  [attr.aria-label]="'Hide password'"
                  [attr.aria-pressed]="hideConfirmPassword">
            <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </mat-form-field>
        <mat-error *ngIf="changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched">
          {{ getErrorMessage('confirmPassword') }}
        </mat-error>
      </div>

      <div class="password-requirements">
        <h4>Yêu cầu mật khẩu:</h4>
        <ul>
          <li>Ít nhất 6 ký tự</li>
          <li>Chứa ít nhất 1 chữ hoa</li>
          <li>Chứa ít nhất 1 chữ thường</li>
          <li>Chứa ít nhất 1 số</li>
        </ul>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button 
            type="button"
            (click)="onCancel()"
            [disabled]="isLoading">
      Hủy
    </button>
    <button mat-raised-button 
            color="primary"
            type="button"
            (click)="onSubmit()"
            [disabled]="changePasswordForm.invalid || isLoading">
      <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
      <mat-icon *ngIf="!isLoading">save</mat-icon>
      {{ isLoading ? 'Đang xử lý...' : 'Đổi mật khẩu' }}
    </button>
  </mat-dialog-actions>
</div>
