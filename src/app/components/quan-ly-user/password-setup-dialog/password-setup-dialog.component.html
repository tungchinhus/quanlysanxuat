<div class="password-setup-dialog">
  <h2 mat-dialog-title>
    <mat-icon>lock_reset</mat-icon>
    Quản lý mật khẩu cho {{ data.user.fullName || data.user.username }}
  </h2>

  <mat-dialog-content>
    <div class="user-info">
      <p><strong>Username:</strong> {{ data.user.username }}</p>
      <p><strong>Email:</strong> {{ data.user.email }}</p>
    </div>

    <mat-tab-group [(selectedIndex)]="currentTab">
      <!-- Tab 1: Thiết lập mật khẩu tạm thời -->
      <mat-tab label="Thiết lập">
        <div class="tab-content">
          <h3>Thiết lập mật khẩu tạm thời</h3>
          <p class="info-text">
            Bước này chỉ cần làm một lần để tạo Firebase Auth account cho user.
            Mật khẩu tạm thời sẽ là: <strong>TempPassword123!</strong>
          </p>
          
          <form [formGroup]="setupForm">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email *</mat-label>
              <input matInput 
                     formControlName="email"
                     placeholder="Nhập email của user">
            </mat-form-field>
            
            <div class="warning-box">
              <mat-icon>warning</mat-icon>
              <p>
                <strong>Lưu ý:</strong> Email này sẽ được sử dụng để tạo Firebase Auth account.
                Đảm bảo email chính xác và chưa được sử dụng trong Firebase Auth.
              </p>
            </div>
          </form>
        </div>
      </mat-tab>

      <!-- Tab 2: Đổi mật khẩu -->
      <mat-tab label="Đổi mật khẩu">
        <div class="tab-content">
          <h3>Đổi mật khẩu</h3>
          <p class="info-text">
            Sau khi đã thiết lập mật khẩu tạm thời, bạn có thể đổi mật khẩu bất kỳ lúc nào.
          </p>
          
          <form [formGroup]="changePasswordForm">
            <div class="form-field">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Mật khẩu mới *</mat-label>
                <input matInput 
                       type="password"
                       formControlName="newPassword"
                       placeholder="Nhập mật khẩu mới">
              </mat-form-field>
              <mat-error *ngIf="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched">
                Mật khẩu phải có ít nhất 6 ký tự, chứa chữ hoa, chữ thường và số
              </mat-error>
            </div>

            <div class="form-field">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Xác nhận mật khẩu *</mat-label>
                <input matInput 
                       type="password"
                       formControlName="confirmPassword"
                       placeholder="Nhập lại mật khẩu mới">
              </mat-form-field>
              <mat-error *ngIf="changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched">
                Mật khẩu xác nhận không khớp
              </mat-error>
            </div>
          </form>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button 
            type="button"
            (click)="onCancel()"
            [disabled]="isLoading">
      Hủy
    </button>
    
    <button mat-raised-button 
            color="primary"
            type="button"
            (click)="onSetupTempPassword()"
            [disabled]="setupForm.invalid || isLoading"
            *ngIf="currentTab === 0">
      <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
      <mat-icon *ngIf="!isLoading">save</mat-icon>
      {{ isLoading ? 'Đang thiết lập...' : 'Thiết lập' }}
    </button>
    
    <button mat-raised-button 
            color="primary"
            type="button"
            (click)="onChangePassword()"
            [disabled]="changePasswordForm.invalid || isLoading"
            *ngIf="currentTab === 1">
      <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
      <mat-icon *ngIf="!isLoading">save</mat-icon>
      {{ isLoading ? 'Đang đổi mật khẩu...' : 'Đổi mật khẩu' }}
    </button>
  </mat-dialog-actions>
</div>
