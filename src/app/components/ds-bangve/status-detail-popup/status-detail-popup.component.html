<div class="status-detail-popup">
  <!-- Header -->
  <div class="popup-header">
    <h2 mat-dialog-title>
      <mat-icon class="header-icon">build</mat-icon>
      Chi tiết trạng thái quấn dây
    </h2>
    <button mat-icon-button (click)="onClose()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div mat-dialog-content class="popup-content">
    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Đang tải thông tin trạng thái...</p>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading" class="content-container">
      <!-- Drawing Info Card -->
      <mat-card class="info-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>description</mat-icon>
            Thông tin bảng vẽ
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <label>Ký hiệu:</label>
              <span class="value">{{ statusData.drawing.kyhieubangve }}</span>
            </div>
            <div class="info-item">
              <label>Công suất:</label>
              <span class="value">{{ statusData.drawing.congsuat }} kVA</span>
            </div>
            <div class="info-item">
              <label>TBKT:</label>
              <span class="value">{{ statusData.drawing.tbkt }}</span>
            </div>
            <div class="info-item">
              <label>Điện áp:</label>
              <span class="value">{{ statusData.drawing.dienap }}</span>
            </div>
            <div class="info-item">
              <label>Ngày tạo:</label>
              <span class="value">{{ formatDate(statusData.drawing.created_at) }}</span>
            </div>
            <div class="info-item">
              <label>Người tạo:</label>
              <span class="value">{{ statusData.drawing.user_create }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Status Overview -->
      <mat-card class="status-overview-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>dashboard</mat-icon>
            Tổng quan trạng thái
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="status-grid">
            <!-- Bối dây hạ -->
            <div class="status-item" [class.collapsed]="!isBdHaExpanded">
              <div class="status-header" (click)="toggleBdHaExpansion()">
                <div class="status-title-section">
                  <mat-icon>electrical_services</mat-icon>
                  <span class="status-title">Bối dây hạ</span>
                </div>
                <button mat-icon-button class="expand-button" [class.expanded]="isBdHaExpanded">
                  <mat-icon>expand_more</mat-icon>
                </button>
              </div>
              <div class="status-chips">
                <mat-chip-set>
                  <mat-chip 
                    [color]="getStatusColor(statusData.bdHaStatus?.trang_thai)"
                    [matTooltip]="'Trạng thái: ' + getStatusText(statusData.bdHaStatus?.trang_thai)">
                    <mat-icon>{{ getStatusIcon(statusData.bdHaStatus?.trang_thai) }}</mat-icon>
                    {{ getStatusText(statusData.bdHaStatus?.trang_thai) }}
                  </mat-chip>
                  <mat-chip 
                    *ngIf="statusData.bdHaStatus?.trang_thai_approve"
                    [color]="getApprovalStatusColor(statusData.bdHaStatus?.trang_thai_approve)"
                    [matTooltip]="'Phê duyệt: ' + getApprovalStatusText(statusData.bdHaStatus?.trang_thai_approve)">
                    <mat-icon>{{ getApprovalStatusIcon(statusData.bdHaStatus?.trang_thai_approve) }}</mat-icon>
                    {{ getApprovalStatusText(statusData.bdHaStatus?.trang_thai_approve) }}
                  </mat-chip>
                </mat-chip-set>
              </div>
              <div class="status-details" *ngIf="isBdHaExpanded && statusData.bdHaStatus">
                <div class="detail-item">
                  <label>Mã số:</label>
                  <span>{{ statusData.bdHaStatus.masothe_bd_ha }}</span>
                </div>
                <div class="detail-item">
                  <label>Người gia công:</label>
                  <span>{{ statusData.bdHaStatus.nguoigiacong }}</span>
                </div>
                <div class="detail-item">
                  <label>Ngày gia công:</label>
                  <span>{{ formatDate(statusData.bdHaStatus.ngaygiacong) }}</span>
                </div>
                <div class="detail-item">
                  <label>Quy cách dây:</label>
                  <span>{{ statusData.bdHaStatus.quycachday }}</span>
                </div>
                <div class="detail-item">
                  <label>Số sợi dây:</label>
                  <span>{{ statusData.bdHaStatus.sosoiday }}</span>
                </div>
                <div class="detail-item">
                  <label>Nhà sản xuất:</label>
                  <span>{{ statusData.bdHaStatus.nhasanxuat }}</span>
                </div>
              </div>
            </div>

            <!-- Bối dây cao -->
            <div class="status-item" [class.collapsed]="!isBdCaoExpanded">
              <div class="status-header" (click)="toggleBdCaoExpansion()">
                <div class="status-title-section">
                  <mat-icon>power</mat-icon>
                  <span class="status-title">Bối dây cao</span>
                </div>
                <button mat-icon-button class="expand-button" [class.expanded]="isBdCaoExpanded">
                  <mat-icon>expand_more</mat-icon>
                </button>
              </div>
              <div class="status-chips">
                <mat-chip-set>
                  <mat-chip 
                    [color]="getStatusColor(statusData.bdCaoStatus?.trang_thai)"
                    [matTooltip]="'Trạng thái: ' + getStatusText(statusData.bdCaoStatus?.trang_thai)">
                    <mat-icon>{{ getStatusIcon(statusData.bdCaoStatus?.trang_thai) }}</mat-icon>
                    {{ getStatusText(statusData.bdCaoStatus?.trang_thai) }}
                  </mat-chip>
                  <mat-chip 
                    *ngIf="statusData.bdCaoStatus?.trang_thai_approve"
                    [color]="getApprovalStatusColor(statusData.bdCaoStatus?.trang_thai_approve)"
                    [matTooltip]="'Phê duyệt: ' + getApprovalStatusText(statusData.bdCaoStatus?.trang_thai_approve)">
                    <mat-icon>{{ getApprovalStatusIcon(statusData.bdCaoStatus?.trang_thai_approve) }}</mat-icon>
                    {{ getApprovalStatusText(statusData.bdCaoStatus?.trang_thai_approve) }}
                  </mat-chip>
                </mat-chip-set>
              </div>
              <div class="status-details" *ngIf="isBdCaoExpanded && statusData.bdCaoStatus">
                <div class="detail-item">
                  <label>Mã số:</label>
                  <span>{{ statusData.bdCaoStatus.masothe_bd_cao }}</span>
                </div>
                <div class="detail-item">
                  <label>Người gia công:</label>
                  <span>{{ statusData.bdCaoStatus.nguoigiacong }}</span>
                </div>
                <div class="detail-item">
                  <label>Ngày gia công:</label>
                  <span>{{ formatDate(statusData.bdCaoStatus.ngaygiacong) }}</span>
                </div>
                <div class="detail-item">
                  <label>Quy cách dây:</label>
                  <span>{{ statusData.bdCaoStatus.quycachday }}</span>
                </div>
                <div class="detail-item">
                  <label>Số sợi dây:</label>
                  <span>{{ statusData.bdCaoStatus.sosoiday }}</span>
                </div>
                <div class="detail-item">
                  <label>Nhà sản xuất:</label>
                  <span>{{ statusData.bdCaoStatus.nhasanxuat }}</span>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Actions -->
  <div mat-dialog-actions class="popup-actions">
    <button mat-button (click)="onClose()" class="close-btn">
      <mat-icon>close</mat-icon>
      Đóng
    </button>
    <button 
      *ngIf="canShowCompleteButton()" 
      mat-raised-button 
      color="primary" 
      (click)="onComplete()" 
      [disabled]="isLoading"
      class="complete-btn">
      <mat-icon>check_circle</mat-icon>
      Hoàn thành
    </button>
  </div>
</div>

