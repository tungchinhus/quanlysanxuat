<div class="import-export-container">
  <!-- Header -->
  <mat-toolbar color="primary" class="header-toolbar">
    <button mat-icon-button (click)="toggleSidenav()" class="menu-button">
      <mat-icon>menu</mat-icon>
    </button>
    <span class="header-title">Import/Export Dữ liệu</span>
    <span class="spacer"></span>
  </mat-toolbar>

  <div class="content-container">
    <mat-tab-group>
      <!-- Export Tab -->
      <mat-tab label="Xuất dữ liệu">
        <div class="tab-content">
          <div class="export-section">
            <h2>Xuất dữ liệu hệ thống</h2>
            <p>Chọn loại dữ liệu và định dạng file để xuất</p>
            
            <div class="export-options">
              <mat-card class="option-card">
                <mat-card-header>
                  <mat-icon mat-card-avatar color="primary">download</mat-icon>
                  <mat-card-title>Xuất tất cả dữ liệu</mat-card-title>
                  <mat-card-subtitle>Users, Roles, Permissions</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="format-selection">
                    <mat-form-field appearance="outline">
                      <mat-label>Định dạng file</mat-label>
                      <mat-select [(ngModel)]="exportFormat">
                        <mat-option value="json">JSON</mat-option>
                        <mat-option value="csv">CSV (nhiều file)</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  
                  <div class="include-options">
                    <h4>Bao gồm:</h4>
                    <mat-checkbox [(ngModel)]="includeUsers">Users</mat-checkbox>
                    <mat-checkbox [(ngModel)]="includeRoles">Roles</mat-checkbox>
                    <mat-checkbox [(ngModel)]="includePermissions">Permissions</mat-checkbox>
                  </div>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-raised-button 
                          color="primary" 
                          (click)="exportAllData()" 
                          [disabled]="isLoading">
                    <mat-icon>download</mat-icon>
                    Xuất tất cả
                  </button>
                </mat-card-actions>
              </mat-card>

              <mat-card class="option-card">
                <mat-card-header>
                  <mat-icon mat-card-avatar color="accent">people</mat-icon>
                  <mat-card-title>Xuất Users</mat-card-title>
                  <mat-card-subtitle>Chỉ danh sách người dùng</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="format-selection">
                    <mat-form-field appearance="outline">
                      <mat-label>Định dạng file</mat-label>
                      <mat-select [(ngModel)]="exportFormat">
                        <mat-option value="json">JSON</mat-option>
                        <mat-option value="csv">CSV</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-raised-button 
                          color="accent" 
                          (click)="exportUsers()" 
                          [disabled]="isLoading">
                    <mat-icon>people</mat-icon>
                    Xuất Users
                  </button>
                </mat-card-actions>
              </mat-card>

              <mat-card class="option-card">
                <mat-card-header>
                  <mat-icon mat-card-avatar color="warn">admin_panel_settings</mat-icon>
                  <mat-card-title>Xuất Roles</mat-card-title>
                  <mat-card-subtitle>Chỉ danh sách vai trò</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="format-selection">
                    <mat-form-field appearance="outline">
                      <mat-label>Định dạng file</mat-label>
                      <mat-select [(ngModel)]="exportFormat">
                        <mat-option value="json">JSON</mat-option>
                        <mat-option value="csv">CSV</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-raised-button 
                          color="warn" 
                          (click)="exportRoles()" 
                          [disabled]="isLoading">
                    <mat-icon>admin_panel_settings</mat-icon>
                    Xuất Roles
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Import Tab -->
      <mat-tab label="Nhập dữ liệu">
        <div class="tab-content">
          <div class="import-section">
            <h2>Nhập dữ liệu hệ thống</h2>
            <p>Chọn file để nhập dữ liệu vào hệ thống</p>
            
            <mat-card class="import-card">
              <mat-card-header>
                <mat-icon mat-card-avatar color="primary">upload</mat-icon>
                <mat-card-title>Chọn file để import</mat-card-title>
                <mat-card-subtitle>Hỗ trợ định dạng JSON và CSV</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="file-selection">
                  <input type="file" 
                         #fileInput 
                         (change)="onFileSelected($event)"
                         accept=".json,.csv"
                         style="display: none;">
                  
                  <div class="file-info" *ngIf="selectedFile">
                    <mat-icon>description</mat-icon>
                    <div class="file-details">
                      <div class="file-name">{{ selectedFile.name }}</div>
                      <div class="file-size">{{ getFileSize() }}</div>
                    </div>
                    <button mat-icon-button (click)="clearFile()" color="warn">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                  
                  <div class="file-actions">
                    <button mat-raised-button 
                            (click)="fileInput.click()"
                            [disabled]="isLoading">
                      <mat-icon>attach_file</mat-icon>
                      Chọn file
                    </button>
                    
                    <div class="format-selection">
                      <mat-form-field appearance="outline">
                        <mat-label>Định dạng file</mat-label>
                        <mat-select [(ngModel)]="importFormat">
                          <mat-option value="json">JSON</mat-option>
                          <mat-option value="csv">CSV</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                </div>

                <div class="import-progress" *ngIf="isLoading">
                  <mat-progress-bar 
                    mode="determinate" 
                    [value]="importProgress">
                  </mat-progress-bar>
                  <p>Đang xử lý file...</p>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-raised-button 
                        color="primary" 
                        (click)="importData()" 
                        [disabled]="!selectedFile || isLoading">
                  <mat-icon>upload</mat-icon>
                  Import dữ liệu
                </button>
              </mat-card-actions>
            </mat-card>

            <div class="import-instructions">
              <h3>Hướng dẫn import:</h3>
              <mat-list>
                <mat-list-item>
                  <mat-icon mat-list-icon>info</mat-icon>
                  <div mat-line>File JSON: Chứa đầy đủ dữ liệu users, roles, permissions</div>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>info</mat-icon>
                  <div mat-line>File CSV: Chỉ chứa dữ liệu users với các cột: Username, Email, Full Name, Phone, Department, Position, Is Active, Roles</div>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>warning</mat-icon>
                  <div mat-line>Kích thước file tối đa: 10MB</div>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>warning</mat-icon>
                  <div mat-line>Dữ liệu trùng lặp sẽ được bỏ qua</div>
                </mat-list-item>
              </mat-list>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>

    <!-- Loading Indicator -->
    <div *ngIf="isLoading" class="loading-overlay">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Đang xử lý...</p>
    </div>
  </div>
</div>
