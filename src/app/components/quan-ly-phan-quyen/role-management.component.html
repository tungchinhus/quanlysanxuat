<div class="role-management-container">
  <div class="header-section">
    <h1>Quản Lý Phân Quyền</h1>
    <p class="subtitle">Quản lý vai trò và quyền hạn của người dùng trong hệ thống</p>
  </div>

  <div class="content-section">
    <div class="action-bar">
      <button 
        mat-raised-button 
        color="primary" 
        (click)="openRoleForm()"
        [disabled]="!canManageRoles()">
        <mat-icon>add</mat-icon>
        Thêm Vai Trò Mới
      </button>
    </div>

    <mat-card class="roles-table-card">
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="roles" class="roles-table">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Tên Vai Trò</th>
              <td mat-cell *matCellDef="let role">
                <div class="role-name">
                  <strong>{{ role.name }}</strong>
                  <span class="role-id">({{ role.id }})</span>
                </div>
              </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Mô Tả</th>
              <td mat-cell *matCellDef="let role">
                <div class="role-description">{{ role.description }}</div>
              </td>
            </ng-container>

            <!-- Permissions Column -->
            <ng-container matColumnDef="permissions">
              <th mat-header-cell *matHeaderCellDef>Quyền Hạn</th>
              <td mat-cell *matCellDef="let role">
                <div class="permissions-container">
                  <div class="permission-badges">
                    <span 
                      *ngFor="let permission of role.permissions" 
                      class="permission-badge"
                      [title]="getPermissionDescription(permission)">
                      {{ getPermissionName(permission) }}
                    </span>
                  </div>
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="openPermissionDialog(role)"
                    [disabled]="!canManageRoles()"
                    title="Chỉnh sửa quyền hạn">
                    <mat-icon>edit</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- User Count Column -->
            <ng-container matColumnDef="userCount">
              <th mat-header-cell *matHeaderCellDef>Số Người Dùng</th>
              <td mat-cell *matCellDef="let role">
                <div class="user-count">
                  <mat-icon>person</mat-icon>
                  <span>{{ role.userCount }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Thao Tác</th>
              <td mat-cell *matCellDef="let role">
                <div class="action-buttons">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="openRoleForm(role)"
                    [disabled]="!canManageRoles()"
                    title="Chỉnh sửa vai trò">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="deleteRole(role)"
                    [disabled]="!canManageRoles() || role.userCount > 0"
                    title="Xóa vai trò">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>

        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Đang tải dữ liệu...</p>
        </div>

        <div *ngIf="!loading && roles.length === 0" class="empty-state">
          <mat-icon>group_work</mat-icon>
          <h3>Chưa có vai trò nào</h3>
          <p>Bắt đầu bằng cách tạo vai trò đầu tiên</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
